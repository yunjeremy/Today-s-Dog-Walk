<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¤ëŠ˜ì˜ ì‚°ì±…</title>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/gghoulmon192.png" />
  <style>
body {
  margin: 0;
  padding: 0;
  font-family: 'Gowun Dodum', sans-serif;
  background-color: #f5f7fa;
  color: #333;
  text-align: center;
}

    header {
      background-color: #4A90E2;
      color: white;
      padding: 20px 0;
      font-size: 24px;
    }

    main {
      padding: 40px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .walk-container {
      display: flex;
      align-items: center;
      gap: 40px;
    }

    button {
      background-color: #4A90E2;
      color: white;
      border: none;
      padding: 20px 40px;
      font-size: 24px;
      border-radius: 50%;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 150px;
      height: 150px;
  white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
  display: flex; /* í”Œë ‰ìŠ¤ë°•ìŠ¤ ì ìš© */
  align-items: center; /* ìˆ˜ì§ ê°€ìš´ë° */
  justify-content: center; /* ìˆ˜í‰ ê°€ìš´ë° */
    }

    button:hover {
      background-color: #357ABD;
    }

    .walk-info {
      text-align: left;
      font-size: 18px;
      line-height: 1.8;
    }

    footer {
      background-color: #ddd;
      padding: 10px 0;
      margin-top: 40px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    ì˜¤ëŠ˜ì˜ ì‚°ì±… ğŸ•
  </header>

  <main>
    <div class="walk-container">
      <button id="walkButton">ì‚°ì±… ì‹œì‘</button>
      <div class="walk-info">
        <p id="time">ì‹œê°„: 0ì‹œ 0ë¶„ 0ì´ˆ</p>
        <p id="distance">ê±°ë¦¬: 0km</p>
        <p id="steps">ê±¸ìŒ ìˆ˜: 0ë³´</p>
      </div>
    </div>
  </main>

  <footer>
    Â© <span id="year"></span> ê¿€ì•„ ì‚¬ë‘í•´ <br>
    ğŸ“§ ì´ë©”ì¼: wofla2592@naver.com <br>
    <a href="#">íšŒì‚¬ ì†Œê°œ</a> | 
    <a href="#">ì´ìš©ì•½ê´€</a> | 
    <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
  </footer>
  
  <script>
    const yearSpan = document.getElementById('year');
const currentYear = new Date().getFullYear();
yearSpan.textContent = currentYear;

const button = document.querySelector('button');
const timeDisplay = document.querySelector('.walk-info p:nth-child(1)');
const distanceDisplay = document.querySelector('.walk-info p:nth-child(2)');
const stepsDisplay = document.querySelector('.walk-info p:nth-child(3)');

let isWalking = false;
let timer;
let seconds = 0;
let distance = 0;
let steps = 0;
let lastAcceleration = null;

// ë‚ ì§œ ì´ˆê¸°í™” í™•ì¸
const today = new Date().toDateString();
const savedDate = localStorage.getItem('walkDate');

if (savedDate !== today) {
  localStorage.setItem('walkDate', today);
  localStorage.setItem('walkSeconds', 0);
  localStorage.setItem('walkDistance', 0);
  localStorage.setItem('walkSteps', 0);
}

// ì €ì¥ëœ ê°’ ë¶ˆëŸ¬ì˜¤ê¸°
seconds = parseInt(localStorage.getItem('walkSeconds'), 10);
distance = parseFloat(localStorage.getItem('walkDistance'));
steps = parseInt(localStorage.getItem('walkSteps'), 10);

updateDisplay();

button.addEventListener('click', () => {
  isWalking = !isWalking;

  if (isWalking) {
    button.textContent = 'ì‚°ì±… ê·¸ë§Œ';

    // íƒ€ì´ë¨¸ ì‹œì‘
    timer = setInterval(() => {
      seconds++;
      localStorage.setItem('walkSeconds', seconds);
      updateDisplay();
    }, 1000);

    // ë§Œë³´ê¸° ì‹œì‘
    initPedometer();

  } else {
    button.textContent = 'ì‚°ì±… ì‹œì‘';
    clearInterval(timer);
    window.removeEventListener('devicemotion', handleMotion); // ì¤‘ì§€ ì‹œ ì„¼ì„œ ë¦¬ìŠ¤ë„ˆ ì œê±°
  }
});

function updateDisplay() {
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const remainingSeconds = seconds % 60;

  timeDisplay.textContent = `ì‹œê°„: ${hours}ì‹œ ${minutes}ë¶„ ${remainingSeconds}ì´ˆ`;
  distanceDisplay.textContent = `ê±°ë¦¬: ${distance.toFixed(2)}km`;
  stepsDisplay.textContent = `ê±¸ìŒ ìˆ˜: ${steps}ë³´`;
}

function initPedometer() {
  if (window.DeviceMotionEvent) {
    window.addEventListener('devicemotion', handleMotion);
  } else {
    alert('ì´ ê¸°ê¸°ëŠ” ë§Œë³´ê¸° ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
}

function handleMotion(event) {
  if (!isWalking) return;

  const acceleration = event.accelerationIncludingGravity;

  if (lastAcceleration) {
    const deltaX = Math.abs(acceleration.x - lastAcceleration.x);
    const deltaY = Math.abs(acceleration.y - lastAcceleration.y);
    const deltaZ = Math.abs(acceleration.z - lastAcceleration.z);

    const totalDelta = deltaX + deltaY + deltaZ;

    if (totalDelta > 3) { // ì„ê³„ê°’ ì¡°ì • ê°€ëŠ¥
      steps++;
      localStorage.setItem('walkSteps', steps);
      updateDisplay();
    }
  }

  lastAcceleration = acceleration;
}

// PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(function(registration) {
      console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration);
    })
    .catch(function(error) {
      console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
    });
  }
  </script>
</body>
</html>
